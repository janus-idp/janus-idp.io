"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9027],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>h});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},c="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(a),d=i,h=c["".concat(l,".").concat(d)]||c[d]||g[d]||r;return a?n.createElement(h,o(o({ref:t},u),{},{components:a})):n.createElement(h,o({ref:t},u))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:i,o[1]=s;for(var p=2;p<r;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},8437:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>g,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var n=a(7462),i=(a(7294),a(3905));const r={title:"Exploring Quay registry in Backstage",authors:["tumido"],tags:["Quay","Plugins"],description:"The Janus IDP family of Backstage plugins is expanding! Please welcome our new member - a frontend plugin that enriches application view in Backstage with insights from a Quay hosted registry."},o="Exploring Quay registry in Backstage",s={permalink:"/blog/2023/02/20/exploring-quay-registry-in-backstage",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2023-02-20-exploring-quay-registry-in-backstage/index.mdx",source:"@site/blog/2023-02-20-exploring-quay-registry-in-backstage/index.mdx",title:"Exploring Quay registry in Backstage",description:"The Janus IDP family of Backstage plugins is expanding! Please welcome our new member - a frontend plugin that enriches application view in Backstage with insights from a Quay hosted registry.",date:"2023-02-20T00:00:00.000Z",formattedDate:"February 20, 2023",tags:[{label:"Quay",permalink:"/blog/tags/quay"},{label:"Plugins",permalink:"/blog/tags/plugins"}],readingTime:3.73,hasTruncateMarker:!1,authors:[{name:"Tom Coufal",title:"Maintainer of Janus Helm Charts & Plugins",url:"https://github.com/tumido",imageURL:"https://github.com/tumido.png",key:"tumido"}],frontMatter:{title:"Exploring Quay registry in Backstage",authors:["tumido"],tags:["Quay","Plugins"],description:"The Janus IDP family of Backstage plugins is expanding! Please welcome our new member - a frontend plugin that enriches application view in Backstage with insights from a Quay hosted registry."},prevItem:{title:"Exposing your 3scale APIs through the Backstage catalog",permalink:"/blog/2023/02/28/exposing-your-3scale-apis"},nextItem:{title:"Using OpenShift Authentication to Secure Access to Backstage",permalink:"/blog/2023/02/20/using-openshift-authentication-to-secure-access-to-backstage"}},l={authorsImageUrls:[void 0]},p=[{value:"Installation and setup",id:"installation-and-setup",level:2},{value:"Connecting to Quay registry via Proxy",id:"connecting-to-quay-registry-via-proxy",level:3},{value:"Enabling Quay plugin widget in UI",id:"enabling-quay-plugin-widget-in-ui",level:3},{value:"Using the plugin",id:"using-the-plugin",level:2},{value:"Next steps",id:"next-steps",level:2}],u={toc:p},c="wrapper";function g(e){let{components:t,...r}=e;return(0,i.kt)(c,(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The Janus IDP family of Backstage plugins is expanding! Please welcome our new member - a frontend plugin that enriches application view in Backstage with insights from a Quay hosted registry."),(0,i.kt)("p",null,"Backstage models the software ecosystem as ",(0,i.kt)("a",{parentName:"p",href:"https://backstage.io/docs/features/software-catalog/software-catalog-overview"},"Backstage Catalog")," entities. Users compose small individual service components into a bigger picture. And in order to truly understand and fully describe the individual building blocks, Backstage users construct views to capture different aspects of these components; from technical documentation, through dependencies and relation to deployment state, CI and CD. And part of this picture is understanding what is actually being deployed into live environments. In many cases, the deployment artifact is a container image and the desire to view all of the available and deployed container images. This new Quay plugin for Backstage brings in that capability."),(0,i.kt)("p",null,"Quay is an OCI-compatible registry that allows users to build, store and distribute container images and other OCI artifacts. It is available as a hosted service on quay.io as well as a self-hosted environment deployable to any OpenShift cluster through a Quay operator. "),(0,i.kt)("h2",{id:"installation-and-setup"},"Installation and setup"),(0,i.kt)("p",null,"With this plugin, viewing available container images in a particular repository is easy. The following guide will elaborate in detail on individual steps for enabling the integration and all currently supported settings and options."),(0,i.kt)("p",null,"First, it is necessary to install the plugin. Please add it to the frontend of your Backstage instance:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn workspace app add @janus-idp/backstage-plugin-quay\n")),(0,i.kt)("h3",{id:"connecting-to-quay-registry-via-proxy"},"Connecting to Quay registry via Proxy"),(0,i.kt)("p",null,"The plugin leverages the Backstage native proxy capabilities to query the Quay API; therefore, configurations need to be made to the ",(0,i.kt)("inlineCode",{parentName:"p"},"app-config.yaml"),". In order to connect the Backstage instance to the public hosted Quay.io environment, the following configuration can be used:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'filename="app-config.yaml"',filename:'"app-config.yaml"'},"proxy:\n  '/quay/api':\n    target: 'https://quay.io'\n    changeOrigin: true\n    headers:\n      X-Requested-With: 'XMLHttpRequest'\n")),(0,i.kt)("p",null,"When accessing private Quay repositories, it may be necessary to extend this configuration with an ",(0,i.kt)("inlineCode",{parentName:"p"},"Authorization")," header and Quay API token. This token can be obtained by creating a Quay Application using the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.quay.io/api/#applications-and-tokens"},"steps outlined in this documentation"),". Once a token is obtained, the header can be set by extending the ",(0,i.kt)("inlineCode",{parentName:"p"},"app-config.yaml")," setup above with an additional header:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'{7} filename="app-config.yaml"',"{7}":!0,filename:'"app-config.yaml"'},"proxy:\n  '/quay/api':\n    target: 'https://quay.io'\n    changeOrigin: true\n    headers:\n      X-Requested-With: 'XMLHttpRequest'\n      Authorization: 'Bearer ${QUAY_TOKEN}'\n")),(0,i.kt)("p",null,"Be aware that the ",(0,i.kt)("inlineCode",{parentName:"p"},"QUAY_TOKEN")," is an environment variable that has to be available to the Backstage instance at runtime."),(0,i.kt)("p",null,"Another popular option is to be able to target a self-hosted Quay deployment. This can be achieved by simply changing the ",(0,i.kt)("inlineCode",{parentName:"p"},"target")," property in the settings above with the location of the Quay instance. In addition, if the self-hosted Quay registry is also deployed with a certificate that is not in the certificate chain of trust for the Backstage instance, the ",(0,i.kt)("inlineCode",{parentName:"p"},"secure")," option has to be unset."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'{3,8} filename="app-config.yaml"',"{3,8}":!0,filename:'"app-config.yaml"'},"proxy:\n  '/quay/api':\n    target: '<SELF_HOSTED_QUAY_ENDPOINT>'\n    changeOrigin: true\n    headers:\n      X-Requested-With: 'XMLHttpRequest'\n      Authorization: 'Bearer ${QUAY_TOKEN}'\n    secure: [true|false]\n")),(0,i.kt)("p",null,"More details on available Backstage proxy settings can be found in the ",(0,i.kt)("a",{parentName:"p",href:"https://backstage.io/docs/plugins/proxying"},"upstream documentation"),". "),(0,i.kt)("p",null,"This plugin conforms to the pattern used by many other Backstage plugins that use the Backstage proxy and provides a mechanism to change the default proxy path ",(0,i.kt)("inlineCode",{parentName:"p"},"/quay/api")," via the following ",(0,i.kt)("inlineCode",{parentName:"p"},"app-config.yaml")," settings, if needed:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'filename="app-config.yaml"',filename:'"app-config.yaml"'},"quay:\n  proxyPath: /custom/quay/path\n")),(0,i.kt)("h3",{id:"enabling-quay-plugin-widget-in-ui"},"Enabling Quay plugin widget in UI"),(0,i.kt)("p",null,"Now that the plugin is configured to access the desired Quay registry, enable the UI by enabling an additional view in the frontend application.(",(0,i.kt)("inlineCode",{parentName:"p"},"packages/app/src/components/catalog/EntityPage.tsx")," file in the bootstrap application)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'filename="packages/app/src/components/catalog/EntityPage.tsx"',filename:'"packages/app/src/components/catalog/EntityPage.tsx"'},'import { QuayPage, isQuayAvailable } from \'@janus-idp/backstage-plugin-quay\';\n\nconst serviceEntityPage = (\n  <EntityPageLayout>\n    // ...\n    <EntityLayout.Route if={isQuayAvailable} path="/quay" title="Quay">\n      <QuayPage />\n    </EntityLayout.Route>\n  </EntityPageLayout>\n);\n')),(0,i.kt)("h2",{id:"using-the-plugin"},"Using the plugin"),(0,i.kt)("p",null,"Finally, after the plugin is fully set up, it needs to be instructed on what data to display for individual catalog entities. Extend the entity with an annotation, a similar experience Backstage users are used to with other plugins:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"metadata:\n  annotations:\n    'quay.io/repository-slug': '<ORGANIZATION>/<REPOSITORY>'\n")),(0,i.kt)("p",null,"For example, if we annotate a ",(0,i.kt)("inlineCode",{parentName:"p"},"Component")," with ",(0,i.kt)("inlineCode",{parentName:"p"},"'quay.io/repository-slug': 'janus-idp/redhat-backstage-build'"),", we are presented with the following page:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Backstage view for janus-idp/redhat-backstage-build Quay repository",src:a(9340).Z,width:"1680",height:"362"})),(0,i.kt)("h2",{id:"next-steps"},"Next steps"),(0,i.kt)("p",null,"Although this plugin doesn\u2019t have the vast features available in the Quay UI, it brings much-needed value to Backstage users.  In the future, we plan to iterate on this plugin and provide users with more insights into unique Quay functions like vulnerability scanning and detailed manifest views."),(0,i.kt)("p",null,"To contribute to this plugin, report issues, seek guidance or provide feedback, please see our GitHub repository ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/janus-idp/backstage-plugins/tree/main/plugins/quay"},"https://github.com/janus-idp/backstage-plugins/tree/main/plugins/quay")," and/or reach out to us on ",(0,i.kt)("a",{parentName:"p",href:"https://join.slack.com/t/janus-idp/shared_invite/zt-1nii16o6e-SGscZ4YtAktL6rRtZZBUfA"},"Janus IDP Slack"),"."))}g.isMDXComponent=!0},9340:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/widget-58ef8301d63738f4def97aed10f86df1.png"}}]);